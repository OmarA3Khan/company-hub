---
- name: Deploy nodejs app
  hosts: dev
  tasks:
    - name: Copy nodejs folder to a server
      copy:
        src: /portal/company-hub/client/client-0.1.0.tgz
        dest: /home/ec2-user/client-0.1.0.tgz
    - name: Unpack the nodejs tar file
      unarchive:
        src: /home/ec2-user/client-0.1.0.tgz
        dest: /home/ec2-user/
        remote_src: yes
    - name: Install Dependencies
      npm:
        path: /home/ec2-user/package
    - name: Start the application
      command:
        chdir: /home/ec2-user/package
        cmd: "(npm start >/dev/null 2>&1 &)"
    - name: Ensure the app is running
      shell: ps aux | grep node
      register: app_status
    - debug: msg={{app_status.stdout_lines}}